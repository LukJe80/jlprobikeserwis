<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Galeria zdjęć — JL Pro Bike Serwis</title>
  <style>
    :root{--bg:#020617;--card:#0b1222;--text:#e5e7eb;--muted:#94a3b8;--border:rgba(255,255,255,.08);--shadow:0 12px 30px rgba(0,0,0,.35);}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);padding:16px}
    h1{margin:0 0 6px;font-size:20px}
    .sub{color:var(--muted);font-size:13px;margin-bottom:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px}
    .img{display:block;border-radius:14px;overflow:hidden;border:1px solid var(--border);background:#000}
    .img img{width:100%;height:160px;object-fit:cover;display:block}
    .err{margin-top:10px;color:#fecaca;background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.35);padding:10px;border-radius:12px}
    .empty{color:var(--muted);padding:14px 0}
    .badge{font-size:12px;color:var(--muted)}
    .top{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
    .hint{font-size:12px;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div>
          <h1>Galeria zdjęć</h1>
          <div class="sub">Podgląd dla klienta — tylko do odczytu.</div>
        </div>
        <div class="badge">JL Pro Bike Serwis</div>
      </div>

      <div id="info" class="badge"></div>
      <div id="grid" class="grid"></div>
      <div id="msg"></div>
      <div class="hint">Jeśli zdjęcia się nie ładują, odśwież stronę (linki są czasowe).</div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const id = (params.get("id") || "").trim();

    const grid = document.getElementById("grid");
    const msg = document.getElementById("msg");
    const info = document.getElementById("info");

    function setError(text){ msg.innerHTML = `<div class="err">${text}</div>`; }
    function setEmpty(){ msg.innerHTML = `<div class="empty">Brak zdjęć.</div>`; }

    async function load(){
      if(!id){ setError("Brak id w linku."); return; }
      info.textContent = `ID zlecenia: ${id}`;

      try{
        const r = await fetch(`/api/order-photos?id=${encodeURIComponent(id)}`, { cache: "no-store" });
        const j = await r.json();

        if(!r.ok){
          setError(j?.error || "Nie udało się wczytać galerii.");
          return;
        }

        const rows = (j && j.photos) ? j.photos : [];
        if(rows.length === 0){
          grid.innerHTML = "";
          setEmpty();
          return;
        }

        msg.innerHTML = "";
        grid.innerHTML = rows.map(p=>{
          const url = p.url;
          return `<a class="img" href="${url}" target="_blank" rel="noopener"><img loading="lazy" src="${url}" alt="zdjęcie"></a>`;
        }).join("");
      }catch(e){
        console.warn(e);
        setError("Nie udało się wczytać galerii.");
      }
    }

    load();
  </script>
</body>
</html>
