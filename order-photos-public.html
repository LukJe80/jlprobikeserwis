<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Galeria zdjęć – JL Pro Bike Serwis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      background:#0f1220;
      color:#fff;
      font-family:system-ui, sans-serif;
      margin:0;
      padding:20px;
    }

    h1 {
      text-align:center;
      margin-bottom:20px;
    }

    .grid {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
      gap:12px;
    }

    .grid img {
      width:100%;
      border-radius:10px;
      cursor:pointer;
      transition:.2s;
    }

    .grid img:hover {
      transform:scale(1.05);
    }

    .error {
      background:#b91c1c;
      padding:16px;
      border-radius:10px;
      text-align:center;
      max-width:400px;
      margin:40px auto;
    }
  </style>
</head>
<body>

<h1>Galeria zdjęć</h1>
<div id="app"></div>

<script>
(async () => {
  const params = new URLSearchParams(window.location.search);
  const code = params.get("code");
  const app = document.getElementById("app");

  if (!code) {
    app.innerHTML = `<div class="error">Brak kodu w linku.</div>`;
    return;
  }

  try {
    const res = await fetch(`/api/order-photos?code=${encodeURIComponent(code)}`);
    const data = await res.json();

    if (!data.photos || data.photos.length === 0) {
      app.innerHTML = `<div class="error">Brak zdjęć.</div>`;
      return;
    }

    const grid = document.createElement("div");
    grid.className = "grid";

    data.photos.forEach(photo => {
      const img = document.createElement("img");
      img.src = photo.url;
      img.onclick = () => window.open(photo.url, "_blank");
      grid.appendChild(img);
    });

    app.appendChild(grid);

  } catch (err) {
    app.innerHTML = `<div class="error">Błąd ładowania galerii.</div>`;
  }
})();
</script>

</body>
</html>
