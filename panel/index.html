<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Panel serwisanta ‚Äì JL Pro Bike Serwis</title>

  <style>
    table {
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #000;
      padding: 6px 10px;
    }
    select {
      padding: 4px;
    }
  </style>
</head>
<body>

<h1>üõ† Panel serwisanta</h1>
<p>Tu bƒôdzie system obs≈Çugi zlece≈Ñ.</p>

<button id="load">Pobierz zlecenia</button>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Imiƒô</th>
      <th>Telefon</th>
      <th>Rower</th>
      <th>Opis</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody id="output">
    <tr>
      <td colspan="6">Kliknij ‚ÄûPobierz zlecenia‚Äù</td>
    </tr>
  </tbody>
</table>

<!-- Supabase -->
<script type="module" src="/panel/supabaseClient.js"></script>

<script type="module">
const tbody = document.getElementById("output");
const button = document.getElementById("load");

const STATUSY = [
  "Rower przyjƒôty do serwisu",
  "W trakcie naprawy",
  "Gotowy do odbioru",
  "Wydany klientowi"
];

button.addEventListener("click", async () => {
  tbody.innerHTML = `<tr><td colspan="6">‚è≥ ≈Åadowanie...</td></tr>`;

  const { data, error } = await window.supabase
    .from("zlecenia")
    .select("*")
    .order("id", { ascending: false });

  if (error) {
    tbody.innerHTML = `<tr><td colspan="6">‚ùå ${error.message}</td></tr>`;
    return;
  }

  tbody.innerHTML = "";

  data.forEach(z => {
    const tr = document.createElement("tr");

    const select = document.createElement("select");
    STATUSY.forEach(s => {
      const opt = document.createElement("option");
      opt.value = s;
      opt.textContent = s;
      if (s === z.status) opt.selected = true;
      select.appendChild(opt);
    });

    select.addEventListener("change", async () => {
      await window.supabase
        .from("zlecenia")
        .update({ status: select.value })
        .eq("id", z.id);
    });

    tr.innerHTML = `
      <td>${z.id}</td>
      <td>${z.imie ?? ""}</td>
      <td>${z.telefon ?? ""}</td>
      <td>${z.typ_roweru ?? ""}</td>
      <td>${z.opis ?? ""}</td>
      <td></td>
    `;

    tr.children[5].appendChild(select);
    tbody.appendChild(tr);
  });
});
</script>

</body>
</html>
